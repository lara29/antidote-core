
SYRINGE_SHA=$(git rev-parse HEAD)
SYRINGE_VERSION=$(git describe --exact-match --tags $(git log -n1 --pretty='%h') 2> /dev/null)

if [ -z $SYRINGE_VERSION ];
then
	SYRINGE_VERSION="dev-$SYRINGE_SHA"
fi

cat <<EOT >> ./cmd/syringed/buildinfo.go
package main

/*
This file is automatically generated by Syringe build scripts.
Please do not edit.
*/

var (
	buildInfo = map[string]string{
		"buildSha": "$SYRINGE_SHA",
		"buildVersion": "$SYRINGE_VERSION",
	}
)

EOT

cat <<EOT >> ./cmd/syrctl/buildinfo.go
package main

/*
This file is automatically generated by Syringe build scripts.
Please do not edit.
*/

var (
	buildInfo = map[string]string{
		"buildSha": "$SYRINGE_SHA",
		"buildVersion": "$SYRINGE_VERSION",
	}
)

EOT
